(()=>{"use strict";const e=(()=>{const e=document.getElementById("board");let t=[];const i=()=>{for(let i=0;i<8;i++)for(let n=0;n<8;n++){const l=document.createElement("div");l.classList.add("tile"),(i+n)%2==1&&l.classList.add("tile-black"),l.id="tile-id-"+(8*i+n),e.appendChild(l),t.push(l)}},n=e=>{t[e].replaceChildren()};return i(),{resetBoard:()=>{e.replaceChildren(),t=[],i()},addPiece:(e,i)=>{n(e.getPosition()),t[i].appendChild(e.getPiece())},removePiece:n,getTiles:()=>t}})(),t=(e,t)=>{const i=e,n="white"===e?1:-1;let l=!1,c=!1,s=!1;const o=document.createElement("div");o.classList.add("piece-"+e),o.setAttribute("draggable","true");let a=t;const d=(e,t,l)=>{let c,s=t[l];const o=[1,9,17,25,33,41,49,57],d=[6,14,22,30,38,46,54,62],r=[0,1,2,3,4,5,6,7],u=[56,57,58,59,60,61,62,63],h=[8,9,10,11,12,13,14,15],g=[48,49,50,51,52,53,54,55],f=r.includes(a)&&"black"===i,b=u.includes(a)&&"black"===i,P=r.includes(a)&&"white"===i,p=u.includes(a)&&"white"===i;return 0===l?o.includes(a)||f||p||(!h.includes(a)&&"black"===i||!g.includes(a)&&"white"===i)&&(s+=7*n,"black"===i&&(s-=2)):1===l?d.includes(a)||f||p||(!h.includes(a)&&"black"===i||!g.includes(a)&&"white"===i)&&(s+=9*n,"black"===i&&(s+=2)):2===l?o.includes(a)||P||b||(!h.includes(a)&&"white"===i||!g.includes(a)&&"black"===i)&&(s+=7*-n,"white"===i&&(s-=2)):3===l&&(d.includes(a)||P||b||(!h.includes(a)&&"white"===i||!g.includes(a)&&"black"===i)&&(s+=9*-n,"white"===i&&(s+=2))),c=document.getElementById("tile-id-"+s),void 0!==c.children[0]?e.push(t[l]):e.push(s),e},r=(e,t)=>{let n=[];for(let l=0;l<e.length;l++)if(null!==e[l]){const c=t[e[l]].id,s=document.getElementById(c),o="white"===i?"black":"white";void 0!==s.children[0]&&s.children[0].classList.contains("piece-"+o)?n=d(n,e,l):n.push(e[l])}return n},u=e=>{let t=[],s=null,o=null,d=null,u=null;const h=[0,1,2,3,4,5,6,7],g=[56,57,58,59,60,61,62,63],f=h.includes(a)&&"black"===i,b=g.includes(a)&&"black"===i,P=h.includes(a)&&"white"===i,p=g.includes(a)&&"white"===i;return a%8==0||f||p||(s=a+7*n,"black"===i&&(s-=2)),[7,15,23,31,39,47,55,63].includes(a)||f||p||(o=a+9*n,"black"===i&&(o+=2)),l&&(a%8==0||P||b||(d=a+7*-n,"white"===i&&(d-=2)),[7,15,23,31,39,47,55,63].includes(a)||P||b||(u=a+9*-n,"white"===i&&(u+=2))),t.push(s),t.push(o),t.push(d),t.push(u),c||(t=r(t,e)),t};return{getPiece:()=>o,getPosition:()=>a,setPosition:e=>{a=parseInt(e)},getAvailablePos:u,getColor:()=>i,getShift:()=>n,upgrade:()=>{l=!0},isKing:()=>l,checkIfAttackAgain:e=>{c=!0;const t=u(e);let i=[];const n=r(t,e);c=!1;for(let e=0;e<t.length;e++)null!==t[e]&&i.push(t[e]);let l=[];for(let e=0;e<i.length;e++)t.includes(n[e])||l.push(n[e]);return l},setDead:()=>{s=!0},isDead:()=>s}};function i(e){console.log(e+" is the winner!")}function n(e){"black"===e?f+=1:b+=1}function l(e){e.upgrade()}function c(e,t){if("black"===t){if([0,1,2,3,4,5,6,7].includes(e.getPosition()))return!0}else if("white"===t&&[56,57,58,59,60,61,62,63].includes(e.getPosition()))return!0;return!1}function s(e,t){P=0!==e.length?Math.abs(t):null}function o(e,t,i,n){let l=e.getShift();if("up"===n){"white"===e.getColor()&&(l=-l);const n=t+14*l;return i===t+14*l-4||i===n}if("down"===n){"black"===e.getColor()&&(l=-l);const n=t+(14*l+4);return i===t+14*l||i===n}}function a(e,t){"black"===t?h.forEach((t=>{t.getPosition()===e&&t.setDead()})):g.forEach((t=>{t.getPosition()===e&&t.setDead()}))}function d(t,l,c){const d=t.getPosition();if(l>d&&o(t,l,d,"up")){const i=l-(l-d)/2;e.removePiece(i),a(i,t.getColor()),n(t.getColor()),s(t.checkIfAttackAgain(e.getTiles()),c)}if(l<d&&o(t,l,d,"down")){const i=l-(l-d)/2;e.removePiece(i),a(i,t.getColor()),n(t.getColor()),s(t.checkIfAttackAgain(e.getTiles()),c)}!function(t){12!==f&&12!==b||i(t);let n=!1;const l=e.getTiles();"black"===t?h.forEach((e=>{if(!e.isDead()){const t=e.getAvailablePos(l);for(let e=0;e<t.length;e++)void 0===document.getElementById("tile-id-"+t[e]).children[0]&&(n=!0)}})):"white"===t&&g.forEach((e=>{if(!e.isDead()){const t=e.getAvailablePos(l);for(let e=0;e<t.length;e++)void 0===document.getElementById("tile-id-"+t[e]).children[0]&&(n=!0)}})),!1===n&&i(t)}(t.getColor())}function r(e,t){let i=1,n=2;"Two"===t&&(i=62,n=-n);for(let t=0;t<3;t++){for(let l=0;l<4;l++)e[4*t+l].setPosition(i),i+=n;0===t&&(i-=n/2),1===t&&(i+=n/2)}}function u(e,i){for(let n=0;n<12;n++){const l=t(i,n);e.push(l)}}let h=[],g=[],f=0,b=0,P=null;u(h,"white"),r(h,"One"),u(g,"black"),r(g,"Two"),h.forEach((t=>{e.addPiece(t,t.getPosition())})),g.forEach((t=>{e.addPiece(t,t.getPosition())})),h.forEach(((e,t)=>{e.getPiece().addEventListener("dragstart",(e=>{e.dataTransfer.setData("text/plain",t+1)}))})),g.forEach(((e,t)=>{e.getPiece().addEventListener("dragstart",(e=>{e.dataTransfer.setData("text/plain",-t-1)}))})),e.getTiles().forEach((t=>{t.addEventListener("dragenter",(()=>{})),t.addEventListener("dragover",(e=>{e.preventDefault()})),t.addEventListener("dragleave",(e=>{e.preventDefault()})),t.addEventListener("drop",(t=>{const i=t.dataTransfer.getData("text/plain");null!==P&&P!==Math.abs(i)||function(t,i){const n=t.target.id,s=i<0?"black":"white";if(function(t,i,n){let l=[];i<0?l=g[Math.abs(i)-1].getAvailablePos(e.getTiles()):i>0&&(l=h[Math.abs(i)-1].getAvailablePos(e.getTiles()));let c=!1;return l.forEach((e=>{n==="tile-id-"+e&&(c=!0)})),c}(0,i,n)){let o;if(void 0===t.target.children[0]){const t=n.split("-");if("black"===s){const n=g[Math.abs(i)-1];e.addPiece(n,t[2]),o=n.getPosition(),n.setPosition(t[2]),d(n,o,i),c(n,s)&&l(n)}else if("white"===s){const n=h[Math.abs(i)-1];e.addPiece(n,t[2]),o=n.getPosition(),n.setPosition(t[2]),d(n,o),c(n,s)&&l(n)}}}}(t,i)}))}))})();